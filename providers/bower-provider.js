'use strict';

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _rxjs = require('rxjs');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var fetch = require('node-fetch');
function search(text) {
    var $get = fetch('https://bower.herokuapp.com/packages/search/' + text);
    return _rxjs.Observable.fromPromise($get.then(function (res) {
        return res.json();
    })).flatMap(function (x) {
        return x;
    });
}
function searchPackage(text, name) {
    var $get = fetch('https://bower.herokuapp.com/packages/' + name);
    var toJson = function toJson(res) {
        return res.json();
    };
    var getReleases = function getReleases(res) {
        if (!_lodash2.default.includes(res.url, 'github')) {
            return;
        }
        var url = res.url.replace('.git', '/tags').replace('git://github.com/', 'https://api.github.com/repos/');
        return fetch(url);
    };
    var getTags = function getTags(rel) {
        return rel.name.replace('v', '');
    };
    return _rxjs.Observable.fromPromise($get.then(toJson).then(getReleases).then(function (res) {
        return res.json();
    })).flatMap(function (x) {
        return x;
    }).map(getTags);
}
function makeSuggestion(item) {
    var type = 'package';
    return {
        _search: item.name,
        snippet: item.name,
        type: type,
        displayText: item.name,
        className: 'autocomplete-json-schema'
    };
}
var packageName = {
    getSuggestions: function getSuggestions(options) {
        return search(options.replacementPrefix).filter(function (r) {
            return _lodash2.default.includes(r.name, options.replacementPrefix);
        }).map(makeSuggestion).toArray().toPromise();
    },

    fileMatchs: ['bower.json'],
    pathMatch: function pathMatch(path) {
        return path === "dependencies";
    },
    dispose: function dispose() {}
};
var packageVersion = {
    getSuggestions: function getSuggestions(options) {
        var name = options.path.split('/');
        return searchPackage(options.replacementPrefix, name[name.length - 1]).map(function (tag) {
            return { name: '^' + tag };
        }).map(makeSuggestion).toArray().toPromise();
    },

    fileMatchs: ['bower.json'],
    pathMatch: function pathMatch(path) {
        return _lodash2.default.startsWith(path, "dependencies/");
    },
    dispose: function dispose() {}
};
var providers = [packageName, packageVersion];
module.exports = providers;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb3ZpZGVycy9ib3dlci1wcm92aWRlci5qcyIsInByb3ZpZGVycy9ib3dlci1wcm92aWRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7O0FBQ0E7Ozs7QUNDQSxJQUFJLFFBQTJDLFFBQVEsWUFBUixDQUEvQztBQW9CQSxTQUFBLE1BQUEsQ0FBZ0IsSUFBaEIsRUFBNEI7QUFDeEIsUUFBSSxPQUFPLHVEQUFxRCxJQUFyRCxDQUFYO0FBQ0EsV0FBTyxpQkFDRixXQURFLENBQ3lCLEtBQUssSUFBTCxDQUFVO0FBQUEsZUFBTyxJQUFJLElBQUosRUFBUDtBQUFBLEtBQVYsQ0FEekIsRUFFRixPQUZFLENBRW1CO0FBQUEsZUFBSyxDQUFMO0FBQUEsS0FGbkIsQ0FBUDtBQUdIO0FBRUQsU0FBQSxhQUFBLENBQXVCLElBQXZCLEVBQXFDLElBQXJDLEVBQWlEO0FBQzdDLFFBQUksT0FBTyxnREFBOEMsSUFBOUMsQ0FBWDtBQUNBLFFBQUksU0FBUyxTQUFULE1BQVMsQ0FBQyxHQUFEO0FBQUEsZUFBa0IsSUFBSSxJQUFKLEVBQWxCO0FBQUEsS0FBYjtBQUNBLFFBQUksY0FBYyxTQUFkLFdBQWMsQ0FBQyxHQUFELEVBQWlCO0FBQy9CLFlBQUksQ0FBQyxpQkFBRSxRQUFGLENBQVcsSUFBSSxHQUFmLEVBQW9CLFFBQXBCLENBQUwsRUFBb0M7QUFDaEM7QUFDSDtBQUNELFlBQUksTUFBTSxJQUFJLEdBQUosQ0FBUSxPQUFSLENBQWdCLE1BQWhCLEVBQXdCLE9BQXhCLEVBQWlDLE9BQWpDLENBQXlDLG1CQUF6QyxFQUE4RCwrQkFBOUQsQ0FBVjtBQUNBLGVBQU8sTUFBTSxHQUFOLENBQVA7QUFDSCxLQU5EO0FBT0EsUUFBSSxVQUFVLFNBQVYsT0FBVSxDQUFDLEdBQUQ7QUFBQSxlQUFvQixJQUFJLElBQUosQ0FBUyxPQUFULENBQWlCLEdBQWpCLEVBQXNCLEVBQXRCLENBQXBCO0FBQUEsS0FBZDtBQUNBLFdBQU8saUJBQ0YsV0FERSxDQUN1QixLQUFLLElBQUwsQ0FBVSxNQUFWLEVBQWtCLElBQWxCLENBQXVCLFdBQXZCLEVBQW9DLElBQXBDLENBQXlDO0FBQUEsZUFBTyxJQUFJLElBQUosRUFBUDtBQUFBLEtBQXpDLENBRHZCLEVBRUYsT0FGRSxDQUVNO0FBQUEsZUFBSyxDQUFMO0FBQUEsS0FGTixFQUdGLEdBSEUsQ0FHRSxPQUhGLENBQVA7QUFJSDtBQUVELFNBQUEsY0FBQSxDQUF3QixJQUF4QixFQUE4QztBQUMxQyxRQUFJLE9BQU8sU0FBWDtBQUVBLFdBQU87QUFDSCxpQkFBUyxLQUFLLElBRFg7QUFFSCxpQkFBUyxLQUFLLElBRlg7QUFHSCxjQUFNLElBSEg7QUFJSCxxQkFBYSxLQUFLLElBSmY7QUFLSCxtQkFBVztBQUxSLEtBQVA7QUFPSDtBQUVELElBQUksY0FBcUM7QUFDckMsa0JBRHFDLDBCQUN0QixPQURzQixFQUNlO0FBQ2hELGVBQU8sT0FBTyxRQUFRLGlCQUFmLEVBQ0YsTUFERSxDQUNLO0FBQUEsbUJBQUksaUJBQUUsUUFBRixDQUFXLEVBQUUsSUFBYixFQUFtQixRQUFRLGlCQUEzQixDQUFKO0FBQUEsU0FETCxFQUVGLEdBRkUsQ0FFRSxjQUZGLEVBR0YsT0FIRSxHQUlGLFNBSkUsRUFBUDtBQUtILEtBUG9DOztBQVFyQyxnQkFBWSxDQUFDLFlBQUQsQ0FSeUI7QUFTckMsYUFUcUMscUJBUzNCLElBVDJCLEVBU3ZCO0FBQUksZUFBTyxTQUFTLGNBQWhCO0FBQWdDLEtBVGI7QUFVckMsV0FWcUMscUJBVTlCLENBQU07QUFWd0IsQ0FBekM7QUFhQSxJQUFJLGlCQUF3QztBQUN4QyxrQkFEd0MsMEJBQ3pCLE9BRHlCLEVBQ1k7QUFDaEQsWUFBSSxPQUFPLFFBQVEsSUFBUixDQUFhLEtBQWIsQ0FBbUIsR0FBbkIsQ0FBWDtBQUNBLGVBQU8sY0FBYyxRQUFRLGlCQUF0QixFQUF5QyxLQUFLLEtBQUssTUFBTCxHQUFjLENBQW5CLENBQXpDLEVBQ0YsR0FERSxDQUNFO0FBQUEsbUJBQVEsRUFBRSxZQUFVLEdBQVosRUFBUjtBQUFBLFNBREYsRUFFRixHQUZFLENBRUUsY0FGRixFQUdGLE9BSEUsR0FJRixTQUpFLEVBQVA7QUFLSCxLQVJ1Qzs7QUFTeEMsZ0JBQVksQ0FBQyxZQUFELENBVDRCO0FBVXhDLGFBVndDLHFCQVU5QixJQVY4QixFQVUxQjtBQUFJLGVBQU8saUJBQUUsVUFBRixDQUFhLElBQWIsRUFBbUIsZUFBbkIsQ0FBUDtBQUE2QyxLQVZ2QjtBQVd4QyxXQVh3QyxxQkFXakMsQ0FBTTtBQVgyQixDQUE1QztBQWNBLElBQUksWUFBWSxDQUFDLFdBQUQsRUFBYyxjQUFkLENBQWhCO0FBQ0EsT0FBTyxPQUFQLEdBQWlCLFNBQWpCIiwiZmlsZSI6InByb3ZpZGVycy9ib3dlci1wcm92aWRlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSBcInJ4anNcIjtcbnZhciBmZXRjaCA9IHJlcXVpcmUoJ25vZGUtZmV0Y2gnKTtcbmZ1bmN0aW9uIHNlYXJjaCh0ZXh0KSB7XG4gICAgdmFyICRnZXQgPSBmZXRjaChgaHR0cHM6Ly9ib3dlci5oZXJva3VhcHAuY29tL3BhY2thZ2VzL3NlYXJjaC8ke3RleHR9YCk7XG4gICAgcmV0dXJuIE9ic2VydmFibGVcbiAgICAgICAgLmZyb21Qcm9taXNlKCRnZXQudGhlbihyZXMgPT4gcmVzLmpzb24oKSkpXG4gICAgICAgIC5mbGF0TWFwKHggPT4geCk7XG59XG5mdW5jdGlvbiBzZWFyY2hQYWNrYWdlKHRleHQsIG5hbWUpIHtcbiAgICB2YXIgJGdldCA9IGZldGNoKGBodHRwczovL2Jvd2VyLmhlcm9rdWFwcC5jb20vcGFja2FnZXMvJHtuYW1lfWApO1xuICAgIHZhciB0b0pzb24gPSAocmVzKSA9PiByZXMuanNvbigpO1xuICAgIHZhciBnZXRSZWxlYXNlcyA9IChyZXMpID0+IHtcbiAgICAgICAgaWYgKCFfLmluY2x1ZGVzKHJlcy51cmwsICdnaXRodWInKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciB1cmwgPSByZXMudXJsLnJlcGxhY2UoJy5naXQnLCAnL3RhZ3MnKS5yZXBsYWNlKCdnaXQ6Ly9naXRodWIuY29tLycsICdodHRwczovL2FwaS5naXRodWIuY29tL3JlcG9zLycpO1xuICAgICAgICByZXR1cm4gZmV0Y2godXJsKTtcbiAgICB9O1xuICAgIHZhciBnZXRUYWdzID0gKHJlbCkgPT4gcmVsLm5hbWUucmVwbGFjZSgndicsICcnKTtcbiAgICByZXR1cm4gT2JzZXJ2YWJsZVxuICAgICAgICAuZnJvbVByb21pc2UoJGdldC50aGVuKHRvSnNvbikudGhlbihnZXRSZWxlYXNlcykudGhlbihyZXMgPT4gcmVzLmpzb24oKSkpXG4gICAgICAgIC5mbGF0TWFwKHggPT4geClcbiAgICAgICAgLm1hcChnZXRUYWdzKTtcbn1cbmZ1bmN0aW9uIG1ha2VTdWdnZXN0aW9uKGl0ZW0pIHtcbiAgICB2YXIgdHlwZSA9ICdwYWNrYWdlJztcbiAgICByZXR1cm4ge1xuICAgICAgICBfc2VhcmNoOiBpdGVtLm5hbWUsXG4gICAgICAgIHNuaXBwZXQ6IGl0ZW0ubmFtZSxcbiAgICAgICAgdHlwZTogdHlwZSxcbiAgICAgICAgZGlzcGxheVRleHQ6IGl0ZW0ubmFtZSxcbiAgICAgICAgY2xhc3NOYW1lOiAnYXV0b2NvbXBsZXRlLWpzb24tc2NoZW1hJyxcbiAgICB9O1xufVxudmFyIHBhY2thZ2VOYW1lID0ge1xuICAgIGdldFN1Z2dlc3Rpb25zKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHNlYXJjaChvcHRpb25zLnJlcGxhY2VtZW50UHJlZml4KVxuICAgICAgICAgICAgLmZpbHRlcihyID0+IF8uaW5jbHVkZXMoci5uYW1lLCBvcHRpb25zLnJlcGxhY2VtZW50UHJlZml4KSlcbiAgICAgICAgICAgIC5tYXAobWFrZVN1Z2dlc3Rpb24pXG4gICAgICAgICAgICAudG9BcnJheSgpXG4gICAgICAgICAgICAudG9Qcm9taXNlKCk7XG4gICAgfSxcbiAgICBmaWxlTWF0Y2hzOiBbJ2Jvd2VyLmpzb24nXSxcbiAgICBwYXRoTWF0Y2gocGF0aCkgeyByZXR1cm4gcGF0aCA9PT0gXCJkZXBlbmRlbmNpZXNcIjsgfSxcbiAgICBkaXNwb3NlKCkgeyB9XG59O1xudmFyIHBhY2thZ2VWZXJzaW9uID0ge1xuICAgIGdldFN1Z2dlc3Rpb25zKG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIG5hbWUgPSBvcHRpb25zLnBhdGguc3BsaXQoJy8nKTtcbiAgICAgICAgcmV0dXJuIHNlYXJjaFBhY2thZ2Uob3B0aW9ucy5yZXBsYWNlbWVudFByZWZpeCwgbmFtZVtuYW1lLmxlbmd0aCAtIDFdKVxuICAgICAgICAgICAgLm1hcCh0YWcgPT4gKHsgbmFtZTogYF4ke3RhZ31gIH0pKVxuICAgICAgICAgICAgLm1hcChtYWtlU3VnZ2VzdGlvbilcbiAgICAgICAgICAgIC50b0FycmF5KClcbiAgICAgICAgICAgIC50b1Byb21pc2UoKTtcbiAgICB9LFxuICAgIGZpbGVNYXRjaHM6IFsnYm93ZXIuanNvbiddLFxuICAgIHBhdGhNYXRjaChwYXRoKSB7IHJldHVybiBfLnN0YXJ0c1dpdGgocGF0aCwgXCJkZXBlbmRlbmNpZXMvXCIpOyB9LFxuICAgIGRpc3Bvc2UoKSB7IH1cbn07XG52YXIgcHJvdmlkZXJzID0gW3BhY2thZ2VOYW1lLCBwYWNrYWdlVmVyc2lvbl07XG5tb2R1bGUuZXhwb3J0cyA9IHByb3ZpZGVycztcbiIsImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XHJcbmltcG9ydCB7T2JzZXJ2YWJsZX0gZnJvbSBcInJ4anNcIjtcclxudmFyIGZldGNoOiAodXJsOiBzdHJpbmcpID0+IFByb21pc2U8SVJlc3VsdD4gPSByZXF1aXJlKCdub2RlLWZldGNoJyk7XHJcblxyXG5pbnRlcmZhY2UgSVJlc3VsdCB7XHJcbiAgICBqc29uPFQ+KCk6IFQ7XHJcbiAgICB0ZXh0KCk6IHN0cmluZztcclxufVxyXG5cclxuaW50ZXJmYWNlIEJvd2VyUmVzdWx0IHtcclxuICAgIG5hbWU6IHN0cmluZyxcclxuICAgIHVybDogc3RyaW5nXHJcbn1cclxuXHJcbmludGVyZmFjZSBCb3dlclBhY2thZ2Uge1xyXG4gICAgdmVyc2lvbjogc3RyaW5nO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgR2l0SHViVGFnIHtcclxuICAgIG5hbWU6IHN0cmluZztcclxufVxyXG5cclxuZnVuY3Rpb24gc2VhcmNoKHRleHQ6IHN0cmluZykge1xyXG4gICAgdmFyICRnZXQgPSBmZXRjaChgaHR0cHM6Ly9ib3dlci5oZXJva3VhcHAuY29tL3BhY2thZ2VzL3NlYXJjaC8ke3RleHR9YCk7XHJcbiAgICByZXR1cm4gT2JzZXJ2YWJsZVxyXG4gICAgICAgIC5mcm9tUHJvbWlzZTxCb3dlclJlc3VsdFtdPigkZ2V0LnRoZW4ocmVzID0+IHJlcy5qc29uPEJvd2VyUmVzdWx0W10+KCkpKVxyXG4gICAgICAgIC5mbGF0TWFwPEJvd2VyUmVzdWx0Pih4ID0+IHgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzZWFyY2hQYWNrYWdlKHRleHQ6IHN0cmluZywgbmFtZTogc3RyaW5nKSB7XHJcbiAgICB2YXIgJGdldCA9IGZldGNoKGBodHRwczovL2Jvd2VyLmhlcm9rdWFwcC5jb20vcGFja2FnZXMvJHtuYW1lfWApO1xyXG4gICAgdmFyIHRvSnNvbiA9IChyZXM6IElSZXN1bHQpID0+IHJlcy5qc29uPEJvd2VyUmVzdWx0PigpO1xyXG4gICAgdmFyIGdldFJlbGVhc2VzID0gKHJlczogQm93ZXJSZXN1bHQpID0+IHtcclxuICAgICAgICBpZiAoIV8uaW5jbHVkZXMocmVzLnVybCwgJ2dpdGh1YicpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHVybCA9IHJlcy51cmwucmVwbGFjZSgnLmdpdCcsICcvdGFncycpLnJlcGxhY2UoJ2dpdDovL2dpdGh1Yi5jb20vJywgJ2h0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3MvJyk7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKHVybCk7XHJcbiAgICB9O1xyXG4gICAgdmFyIGdldFRhZ3MgPSAocmVsOiBHaXRIdWJUYWcpID0+IHJlbC5uYW1lLnJlcGxhY2UoJ3YnLCAnJyk7XHJcbiAgICByZXR1cm4gT2JzZXJ2YWJsZVxyXG4gICAgICAgIC5mcm9tUHJvbWlzZTxHaXRIdWJUYWdbXT4oJGdldC50aGVuKHRvSnNvbikudGhlbihnZXRSZWxlYXNlcykudGhlbihyZXMgPT4gcmVzLmpzb248R2l0SHViVGFnW10+KCkpKVxyXG4gICAgICAgIC5mbGF0TWFwKHggPT4geClcclxuICAgICAgICAubWFwKGdldFRhZ3MpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBtYWtlU3VnZ2VzdGlvbihpdGVtOiB7IG5hbWU6IHN0cmluZyB9KSB7XHJcbiAgICB2YXIgdHlwZSA9ICdwYWNrYWdlJztcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIF9zZWFyY2g6IGl0ZW0ubmFtZSxcclxuICAgICAgICBzbmlwcGV0OiBpdGVtLm5hbWUsXHJcbiAgICAgICAgdHlwZTogdHlwZSxcclxuICAgICAgICBkaXNwbGF5VGV4dDogaXRlbS5uYW1lLFxyXG4gICAgICAgIGNsYXNzTmFtZTogJ2F1dG9jb21wbGV0ZS1qc29uLXNjaGVtYScsXHJcbiAgICB9XHJcbn1cclxuXHJcbnZhciBwYWNrYWdlTmFtZTogSUF1dG9jb21wbGV0ZVByb3ZpZGVyID0ge1xyXG4gICAgZ2V0U3VnZ2VzdGlvbnMob3B0aW9uczogSUF1dG9jb21wbGV0ZVByb3ZpZGVyT3B0aW9ucykge1xyXG4gICAgICAgIHJldHVybiBzZWFyY2gob3B0aW9ucy5yZXBsYWNlbWVudFByZWZpeClcclxuICAgICAgICAgICAgLmZpbHRlcihyPT4gXy5pbmNsdWRlcyhyLm5hbWUsIG9wdGlvbnMucmVwbGFjZW1lbnRQcmVmaXgpKVxyXG4gICAgICAgICAgICAubWFwKG1ha2VTdWdnZXN0aW9uKVxyXG4gICAgICAgICAgICAudG9BcnJheSgpXHJcbiAgICAgICAgICAgIC50b1Byb21pc2UoKTtcclxuICAgIH0sXHJcbiAgICBmaWxlTWF0Y2hzOiBbJ2Jvd2VyLmpzb24nXSxcclxuICAgIHBhdGhNYXRjaChwYXRoKSB7IHJldHVybiBwYXRoID09PSBcImRlcGVuZGVuY2llc1wiIH0sXHJcbiAgICBkaXNwb3NlKCkgeyB9XHJcbn1cclxuXHJcbnZhciBwYWNrYWdlVmVyc2lvbjogSUF1dG9jb21wbGV0ZVByb3ZpZGVyID0ge1xyXG4gICAgZ2V0U3VnZ2VzdGlvbnMob3B0aW9uczogSUF1dG9jb21wbGV0ZVByb3ZpZGVyT3B0aW9ucykge1xyXG4gICAgICAgIHZhciBuYW1lID0gb3B0aW9ucy5wYXRoLnNwbGl0KCcvJyk7XHJcbiAgICAgICAgcmV0dXJuIHNlYXJjaFBhY2thZ2Uob3B0aW9ucy5yZXBsYWNlbWVudFByZWZpeCwgbmFtZVtuYW1lLmxlbmd0aCAtIDFdKVxyXG4gICAgICAgICAgICAubWFwKHRhZyA9PiAoeyBuYW1lOiBgXiR7dGFnfWAgfSkpXHJcbiAgICAgICAgICAgIC5tYXAobWFrZVN1Z2dlc3Rpb24pXHJcbiAgICAgICAgICAgIC50b0FycmF5KClcclxuICAgICAgICAgICAgLnRvUHJvbWlzZSgpO1xyXG4gICAgfSxcclxuICAgIGZpbGVNYXRjaHM6IFsnYm93ZXIuanNvbiddLFxyXG4gICAgcGF0aE1hdGNoKHBhdGgpIHsgcmV0dXJuIF8uc3RhcnRzV2l0aChwYXRoLCBcImRlcGVuZGVuY2llcy9cIik7IH0sXHJcbiAgICBkaXNwb3NlKCkgeyB9XHJcbn1cclxuXHJcbnZhciBwcm92aWRlcnMgPSBbcGFja2FnZU5hbWUsIHBhY2thZ2VWZXJzaW9uXTtcclxubW9kdWxlLmV4cG9ydHMgPSBwcm92aWRlcnM7XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
