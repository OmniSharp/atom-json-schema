"use strict";

var _lodash = require("lodash");

var _ = _interopRequireWildcard(_lodash);

var _rxjs = require("rxjs");

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

var fetch = require('node-fetch');
var filter = require('fuzzaldrin').filter;
function search(text) {
    return _rxjs.Observable.fromPromise(fetch("https://skimdb.npmjs.com/registry/_design/app/_view/browseAll?group_level=1&limit=100&start_key=%5B%22" + encodeURIComponent(text) + "%22,%7B%7D%5D&end_key=%5B%22" + encodeURIComponent(text) + "z%22,%7B%7D%5D").then(function (res) {
        return res.json();
    })).flatMap(function (z) {
        return _rxjs.Observable.from(z.rows);
    });
}
function searchPackage(text, name) {
    return _rxjs.Observable.fromPromise(fetch("http://registry.npmjs.org/" + name + "/latest").then(function (res) {
        return res.json();
    }));
}
function makeSuggestion(item) {
    var type = 'package';
    return {
        _search: item.key,
        text: item.key,
        snippet: item.key,
        type: type,
        displayText: item.key,
        className: 'autocomplete-json-schema'
    };
}
var packageName = {
    getSuggestions: function getSuggestions(options) {
        if (!options.replacementPrefix) return Promise.resolve([]);
        return search(options.replacementPrefix).map(makeSuggestion).toArray().toPromise();
    },

    fileMatchs: ['package.json'],
    pathMatch: function pathMatch(path) {
        return path === "dependencies" || path === "devDependencies";
    },
    dispose: function dispose() {}
};
var packageVersion = {
    getSuggestions: function getSuggestions(options) {
        var name = options.path.split('/');
        return searchPackage(options.replacementPrefix, name[name.length - 1]).map(function (z) {
            return { key: "^" + z.version };
        }).map(makeSuggestion).toArray().toPromise();
    },

    fileMatchs: ['package.json'],
    pathMatch: function pathMatch(path) {
        return _.startsWith(path, "dependencies/") || _.startsWith(path, "devDependencies/");
    },
    dispose: function dispose() {}
};
var providers = [packageName, packageVersion];
module.exports = providers;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb3ZpZGVycy9ucG0tcHJvdmlkZXIuanMiLCJwcm92aWRlcnMvbnBtLXByb3ZpZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7O0lDQVksQzs7QURDWjs7OztBQ0NBLElBQUksUUFBMkMsUUFBUSxZQUFSLENBQS9DO0FBQ0EsSUFBSSxTQUFTLFFBQVEsWUFBUixFQUFzQixNQUFuQztBQWdCQSxTQUFBLE1BQUEsQ0FBZ0IsSUFBaEIsRUFBNEI7QUFDeEIsV0FBTyxpQkFBVyxXQUFYLENBQ0gsaUhBQStHLG1CQUFtQixJQUFuQixDQUEvRyxvQ0FBdUssbUJBQW1CLElBQW5CLENBQXZLLHFCQUNLLElBREwsQ0FDVTtBQUFBLGVBQU8sSUFBSSxJQUFKLEVBQVA7QUFBQSxLQURWLENBREcsRUFJRixPQUpFLENBSU07QUFBQSxlQUNMLGlCQUFXLElBQVgsQ0FBZ0IsRUFBRSxJQUFsQixDQURLO0FBQUEsS0FKTixDQUFQO0FBTUg7QUFHRCxTQUFBLGFBQUEsQ0FBdUIsSUFBdkIsRUFBcUMsSUFBckMsRUFBaUQ7QUFDN0MsV0FBTyxpQkFBVyxXQUFYLENBQ0gscUNBQW1DLElBQW5DLGNBQ0ssSUFETCxDQUNVO0FBQUEsZUFBTyxJQUFJLElBQUosRUFBUDtBQUFBLEtBRFYsQ0FERyxDQUFQO0FBSUg7QUFFRCxTQUFBLGNBQUEsQ0FBd0IsSUFBeEIsRUFBNkM7QUFDekMsUUFBSSxPQUFPLFNBQVg7QUFFQSxXQUFPO0FBQ0gsaUJBQVMsS0FBSyxHQURYO0FBRUgsY0FBTSxLQUFLLEdBRlI7QUFHSCxpQkFBUyxLQUFLLEdBSFg7QUFJSCxjQUFNLElBSkg7QUFLSCxxQkFBYSxLQUFLLEdBTGY7QUFNSCxtQkFBVztBQU5SLEtBQVA7QUFRSDtBQUVELElBQUksY0FBcUM7QUFDckMsa0JBRHFDLDBCQUN0QixPQURzQixFQUNlO0FBQ2hELFlBQUksQ0FBQyxRQUFRLGlCQUFiLEVBQWdDLE9BQU8sUUFBUSxPQUFSLENBQWdCLEVBQWhCLENBQVA7QUFDaEMsZUFBWSxPQUFPLFFBQVEsaUJBQWYsRUFDUCxHQURPLENBQ0gsY0FERyxFQUVQLE9BRk8sR0FHUCxTQUhPLEVBQVo7QUFJSCxLQVBvQzs7QUFRckMsZ0JBQVksQ0FBQyxjQUFELENBUnlCO0FBU3JDLGFBVHFDLHFCQVMzQixJQVQyQixFQVN2QjtBQUNWLGVBQU8sU0FBUyxjQUFULElBQTJCLFNBQVMsaUJBQTNDO0FBQ0gsS0FYb0M7QUFZckMsV0FacUMscUJBWTlCLENBQU07QUFad0IsQ0FBekM7QUFrQkEsSUFBSSxpQkFBd0M7QUFDeEMsa0JBRHdDLDBCQUN6QixPQUR5QixFQUNZO0FBQ2hELFlBQUksT0FBTyxRQUFRLElBQVIsQ0FBYSxLQUFiLENBQW1CLEdBQW5CLENBQVg7QUFDQSxlQUFZLGNBQWMsUUFBUSxpQkFBdEIsRUFBeUMsS0FBSyxLQUFLLE1BQUwsR0FBYyxDQUFuQixDQUF6QyxFQUNQLEdBRE8sQ0FDSDtBQUFBLG1CQUFNLEVBQUUsV0FBUyxFQUFFLE9BQWIsRUFBTjtBQUFBLFNBREcsRUFFUCxHQUZPLENBRUgsY0FGRyxFQUdQLE9BSE8sR0FJUCxTQUpPLEVBQVo7QUFLSCxLQVJ1Qzs7QUFTeEMsZ0JBQVksQ0FBQyxjQUFELENBVDRCO0FBVXhDLGFBVndDLHFCQVU5QixJQVY4QixFQVUxQjtBQUNWLGVBQU8sRUFBRSxVQUFGLENBQWEsSUFBYixFQUFtQixlQUFuQixLQUF1QyxFQUFFLFVBQUYsQ0FBYSxJQUFiLEVBQW1CLGtCQUFuQixDQUE5QztBQUNILEtBWnVDO0FBYXhDLFdBYndDLHFCQWFqQyxDQUFNO0FBYjJCLENBQTVDO0FBbUJBLElBQUksWUFBWSxDQUFDLFdBQUQsRUFBYyxjQUFkLENBQWhCO0FBQ0EsT0FBTyxPQUFQLEdBQWlCLFNBQWpCIiwiZmlsZSI6InByb3ZpZGVycy9ucG0tcHJvdmlkZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBfIGZyb20gXCJsb2Rhc2hcIjtcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwicnhqc1wiO1xudmFyIGZldGNoID0gcmVxdWlyZSgnbm9kZS1mZXRjaCcpO1xudmFyIGZpbHRlciA9IHJlcXVpcmUoJ2Z1enphbGRyaW4nKS5maWx0ZXI7XG5mdW5jdGlvbiBzZWFyY2godGV4dCkge1xuICAgIHJldHVybiBPYnNlcnZhYmxlLmZyb21Qcm9taXNlKGZldGNoKGBodHRwczovL3NraW1kYi5ucG1qcy5jb20vcmVnaXN0cnkvX2Rlc2lnbi9hcHAvX3ZpZXcvYnJvd3NlQWxsP2dyb3VwX2xldmVsPTEmbGltaXQ9MTAwJnN0YXJ0X2tleT0lNUIlMjIke2VuY29kZVVSSUNvbXBvbmVudCh0ZXh0KX0lMjIsJTdCJTdEJTVEJmVuZF9rZXk9JTVCJTIyJHtlbmNvZGVVUklDb21wb25lbnQodGV4dCl9eiUyMiwlN0IlN0QlNURgKVxuICAgICAgICAudGhlbihyZXMgPT4gcmVzLmpzb24oKSkpXG4gICAgICAgIC5mbGF0TWFwKHogPT4gT2JzZXJ2YWJsZS5mcm9tKHoucm93cykpO1xufVxuZnVuY3Rpb24gc2VhcmNoUGFja2FnZSh0ZXh0LCBuYW1lKSB7XG4gICAgcmV0dXJuIE9ic2VydmFibGUuZnJvbVByb21pc2UoZmV0Y2goYGh0dHA6Ly9yZWdpc3RyeS5ucG1qcy5vcmcvJHtuYW1lfS9sYXRlc3RgKVxuICAgICAgICAudGhlbihyZXMgPT4gcmVzLmpzb24oKSkpO1xufVxuZnVuY3Rpb24gbWFrZVN1Z2dlc3Rpb24oaXRlbSkge1xuICAgIHZhciB0eXBlID0gJ3BhY2thZ2UnO1xuICAgIHJldHVybiB7XG4gICAgICAgIF9zZWFyY2g6IGl0ZW0ua2V5LFxuICAgICAgICB0ZXh0OiBpdGVtLmtleSxcbiAgICAgICAgc25pcHBldDogaXRlbS5rZXksXG4gICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgIGRpc3BsYXlUZXh0OiBpdGVtLmtleSxcbiAgICAgICAgY2xhc3NOYW1lOiAnYXV0b2NvbXBsZXRlLWpzb24tc2NoZW1hJyxcbiAgICB9O1xufVxudmFyIHBhY2thZ2VOYW1lID0ge1xuICAgIGdldFN1Z2dlc3Rpb25zKG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKCFvcHRpb25zLnJlcGxhY2VtZW50UHJlZml4KVxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShbXSk7XG4gICAgICAgIHJldHVybiBzZWFyY2gob3B0aW9ucy5yZXBsYWNlbWVudFByZWZpeClcbiAgICAgICAgICAgIC5tYXAobWFrZVN1Z2dlc3Rpb24pXG4gICAgICAgICAgICAudG9BcnJheSgpXG4gICAgICAgICAgICAudG9Qcm9taXNlKCk7XG4gICAgfSxcbiAgICBmaWxlTWF0Y2hzOiBbJ3BhY2thZ2UuanNvbiddLFxuICAgIHBhdGhNYXRjaChwYXRoKSB7XG4gICAgICAgIHJldHVybiBwYXRoID09PSBcImRlcGVuZGVuY2llc1wiIHx8IHBhdGggPT09IFwiZGV2RGVwZW5kZW5jaWVzXCI7XG4gICAgfSxcbiAgICBkaXNwb3NlKCkgeyB9XG59O1xudmFyIHBhY2thZ2VWZXJzaW9uID0ge1xuICAgIGdldFN1Z2dlc3Rpb25zKG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIG5hbWUgPSBvcHRpb25zLnBhdGguc3BsaXQoJy8nKTtcbiAgICAgICAgcmV0dXJuIHNlYXJjaFBhY2thZ2Uob3B0aW9ucy5yZXBsYWNlbWVudFByZWZpeCwgbmFtZVtuYW1lLmxlbmd0aCAtIDFdKVxuICAgICAgICAgICAgLm1hcCh6ID0+ICh7IGtleTogYF4ke3oudmVyc2lvbn1gIH0pKVxuICAgICAgICAgICAgLm1hcChtYWtlU3VnZ2VzdGlvbilcbiAgICAgICAgICAgIC50b0FycmF5KClcbiAgICAgICAgICAgIC50b1Byb21pc2UoKTtcbiAgICB9LFxuICAgIGZpbGVNYXRjaHM6IFsncGFja2FnZS5qc29uJ10sXG4gICAgcGF0aE1hdGNoKHBhdGgpIHtcbiAgICAgICAgcmV0dXJuIF8uc3RhcnRzV2l0aChwYXRoLCBcImRlcGVuZGVuY2llcy9cIikgfHwgXy5zdGFydHNXaXRoKHBhdGgsIFwiZGV2RGVwZW5kZW5jaWVzL1wiKTtcbiAgICB9LFxuICAgIGRpc3Bvc2UoKSB7IH1cbn07XG52YXIgcHJvdmlkZXJzID0gW3BhY2thZ2VOYW1lLCBwYWNrYWdlVmVyc2lvbl07XG5tb2R1bGUuZXhwb3J0cyA9IHByb3ZpZGVycztcbiIsImltcG9ydCAqIGFzIF8gZnJvbSBcImxvZGFzaFwiO1xyXG5pbXBvcnQge09ic2VydmFibGV9IGZyb20gXCJyeGpzXCI7XHJcbnZhciBmZXRjaDogKHVybDogc3RyaW5nKSA9PiBQcm9taXNlPElSZXN1bHQ+ID0gcmVxdWlyZSgnbm9kZS1mZXRjaCcpO1xyXG52YXIgZmlsdGVyID0gcmVxdWlyZSgnZnV6emFsZHJpbicpLmZpbHRlcjtcclxuXHJcbmludGVyZmFjZSBJUmVzdWx0IHtcclxuICAgIGpzb248VD4oKTogVDtcclxuICAgIHRleHQoKTogc3RyaW5nO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgTnBtUmVzdWx0IHtcclxuICAgIHJvd3M6IHsga2V5OiBzdHJpbmc7IHZhbHVlOiBzdHJpbmc7IH1bXTtcclxufVxyXG5cclxuaW50ZXJmYWNlIE5wbVBhY2thZ2Uge1xyXG4gICAgdmVyc2lvbjogc3RyaW5nO1xyXG59XHJcblxyXG4vL2h0dHBzOi8vc2tpbWRiLm5wbWpzLmNvbS9yZWdpc3RyeS9fZGVzaWduL2FwcC9fdmlldy9icm93c2VBbGw/Z3JvdXBfbGV2ZWw9MVxyXG5mdW5jdGlvbiBzZWFyY2godGV4dDogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gT2JzZXJ2YWJsZS5mcm9tUHJvbWlzZTxOcG1SZXN1bHQ+KFxyXG4gICAgICAgIGZldGNoKGBodHRwczovL3NraW1kYi5ucG1qcy5jb20vcmVnaXN0cnkvX2Rlc2lnbi9hcHAvX3ZpZXcvYnJvd3NlQWxsP2dyb3VwX2xldmVsPTEmbGltaXQ9MTAwJnN0YXJ0X2tleT0lNUIlMjIke2VuY29kZVVSSUNvbXBvbmVudCh0ZXh0KSB9JTIyLCU3QiU3RCU1RCZlbmRfa2V5PSU1QiUyMiR7ZW5jb2RlVVJJQ29tcG9uZW50KHRleHQpIH16JTIyLCU3QiU3RCU1RGApXHJcbiAgICAgICAgICAgIC50aGVuKHJlcyA9PiByZXMuanNvbjxOcG1SZXN1bHQ+KCkpXHJcbiAgICAgICAgKVxyXG4gICAgICAgIC5mbGF0TWFwKHogPT5cclxuICAgICAgICAgICAgT2JzZXJ2YWJsZS5mcm9tKHoucm93cykpO1xyXG59XHJcblxyXG4vL2h0dHA6Ly9yZWdpc3RyeS5ucG1qcy5vcmcvZ3VscC9sYXRlc3RcclxuZnVuY3Rpb24gc2VhcmNoUGFja2FnZSh0ZXh0OiBzdHJpbmcsIG5hbWU6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIE9ic2VydmFibGUuZnJvbVByb21pc2U8TnBtUGFja2FnZT4oXHJcbiAgICAgICAgZmV0Y2goYGh0dHA6Ly9yZWdpc3RyeS5ucG1qcy5vcmcvJHtuYW1lfS9sYXRlc3RgKVxyXG4gICAgICAgICAgICAudGhlbihyZXMgPT4gcmVzLmpzb248TnBtUGFja2FnZT4oKSlcclxuICAgICAgICApO1xyXG59XHJcblxyXG5mdW5jdGlvbiBtYWtlU3VnZ2VzdGlvbihpdGVtOiB7IGtleTogc3RyaW5nIH0pIHtcclxuICAgIHZhciB0eXBlID0gJ3BhY2thZ2UnO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgX3NlYXJjaDogaXRlbS5rZXksXHJcbiAgICAgICAgdGV4dDogaXRlbS5rZXksXHJcbiAgICAgICAgc25pcHBldDogaXRlbS5rZXksXHJcbiAgICAgICAgdHlwZTogdHlwZSxcclxuICAgICAgICBkaXNwbGF5VGV4dDogaXRlbS5rZXksXHJcbiAgICAgICAgY2xhc3NOYW1lOiAnYXV0b2NvbXBsZXRlLWpzb24tc2NoZW1hJyxcclxuICAgIH1cclxufVxyXG5cclxudmFyIHBhY2thZ2VOYW1lOiBJQXV0b2NvbXBsZXRlUHJvdmlkZXIgPSB7XHJcbiAgICBnZXRTdWdnZXN0aW9ucyhvcHRpb25zOiBJQXV0b2NvbXBsZXRlUHJvdmlkZXJPcHRpb25zKSB7XHJcbiAgICAgICAgaWYgKCFvcHRpb25zLnJlcGxhY2VtZW50UHJlZml4KSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKFtdKTtcclxuICAgICAgICByZXR1cm4gPGFueT5zZWFyY2gob3B0aW9ucy5yZXBsYWNlbWVudFByZWZpeClcclxuICAgICAgICAgICAgLm1hcChtYWtlU3VnZ2VzdGlvbilcclxuICAgICAgICAgICAgLnRvQXJyYXkoKVxyXG4gICAgICAgICAgICAudG9Qcm9taXNlKCk7XHJcbiAgICB9LFxyXG4gICAgZmlsZU1hdGNoczogWydwYWNrYWdlLmpzb24nXSxcclxuICAgIHBhdGhNYXRjaChwYXRoKSB7XHJcbiAgICAgICAgcmV0dXJuIHBhdGggPT09IFwiZGVwZW5kZW5jaWVzXCIgfHwgcGF0aCA9PT0gXCJkZXZEZXBlbmRlbmNpZXNcIjtcclxuICAgIH0sXHJcbiAgICBkaXNwb3NlKCkgeyB9XHJcbiAgICAvL2dldFN1Z2dlc3Rpb25zOiBfLnRocm90dGxlKGdldFN1Z2dlc3Rpb25zLCAwKSxcclxuICAgIC8vb25EaWRJbnNlcnRTdWdnZXN0aW9uLFxyXG4gICAgLy9kaXNwb3NlXHJcbn1cclxuXHJcbnZhciBwYWNrYWdlVmVyc2lvbjogSUF1dG9jb21wbGV0ZVByb3ZpZGVyID0ge1xyXG4gICAgZ2V0U3VnZ2VzdGlvbnMob3B0aW9uczogSUF1dG9jb21wbGV0ZVByb3ZpZGVyT3B0aW9ucykge1xyXG4gICAgICAgIHZhciBuYW1lID0gb3B0aW9ucy5wYXRoLnNwbGl0KCcvJyk7XHJcbiAgICAgICAgcmV0dXJuIDxhbnk+c2VhcmNoUGFja2FnZShvcHRpb25zLnJlcGxhY2VtZW50UHJlZml4LCBuYW1lW25hbWUubGVuZ3RoIC0gMV0pXHJcbiAgICAgICAgICAgIC5tYXAoeiA9PiAoeyBrZXk6IGBeJHt6LnZlcnNpb259YCB9KSlcclxuICAgICAgICAgICAgLm1hcChtYWtlU3VnZ2VzdGlvbilcclxuICAgICAgICAgICAgLnRvQXJyYXkoKVxyXG4gICAgICAgICAgICAudG9Qcm9taXNlKCk7XHJcbiAgICB9LFxyXG4gICAgZmlsZU1hdGNoczogWydwYWNrYWdlLmpzb24nXSxcclxuICAgIHBhdGhNYXRjaChwYXRoKSB7XHJcbiAgICAgICAgcmV0dXJuIF8uc3RhcnRzV2l0aChwYXRoLCBcImRlcGVuZGVuY2llcy9cIikgfHwgXy5zdGFydHNXaXRoKHBhdGgsIFwiZGV2RGVwZW5kZW5jaWVzL1wiKTtcclxuICAgIH0sXHJcbiAgICBkaXNwb3NlKCkgeyB9XHJcbiAgICAvL2dldFN1Z2dlc3Rpb25zOiBfLnRocm90dGxlKGdldFN1Z2dlc3Rpb25zLCAwKSxcclxuICAgIC8vb25EaWRJbnNlcnRTdWdnZXN0aW9uLFxyXG4gICAgLy9kaXNwb3NlXHJcbn1cclxuXHJcbnZhciBwcm92aWRlcnMgPSBbcGFja2FnZU5hbWUsIHBhY2thZ2VWZXJzaW9uXTtcclxubW9kdWxlLmV4cG9ydHMgPSBwcm92aWRlcnM7XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
