'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.CompletionProvider = undefined;

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _jsonSchemaService = require('./vscode/plugin/jsonSchemaService');

var _jsonParser = require('./vscode/plugin/jsonParser');

var _jsonCompletion = require('./vscode/plugin/jsonCompletion');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var filter = require('fuzzaldrin').filter;

var jsonSchemaService = new _jsonSchemaService.JSONSchemaService();
var jsonCompletion = new _jsonCompletion.JSONCompletion(jsonSchemaService, []);
function fixSnippet(snippet, options, type) {
    var t = _lodash2.default.trim(snippet);
    if (_lodash2.default.startsWith(t, '{') || _lodash2.default.startsWith(t, '"') || _lodash2.default.endsWith(t, '}') || _lodash2.default.endsWith(t, '"') || _lodash2.default.endsWith(t, ',')) return snippet;
    if (!options.hasLeadingQuote) snippet = '"' + snippet;
    if (!options.hasTrailingQuote && !_lodash2.default.endsWith(snippet, '.')) snippet = snippet + '"';
    if (type === "string") {
        snippet = snippet += ': ""';
    } else if (type === "object") {
        snippet = snippet += ': {}';
    } else if (type === "array") {
        snippet = snippet += ': []';
    }
    return snippet;
}
function makeSuggestion(item, options) {
    var description = item.description,
        leftLabel = item.type.substr(0, 1),
        type = 'variable';
    return {
        _search: item.key,
        text: item.key,
        snippet: fixSnippet(item.key, options, item.type),
        type: type,
        displayText: item.key,
        className: 'autocomplete-json-schema',
        description: description
    };
}
function renderReturnType(returnType) {
    if (returnType === null) {
        return;
    }
    return 'Returns: ' + returnType;
}
function getSuggestions(options) {
    return jsonCompletion.doSuggest(options.editor, options.bufferPosition, (0, _jsonParser.parse)(options.editor.getText())).then(function (x) {
        return x.items;
    });
}
var providers = [].concat(require('./providers/npm-provider')).concat(require('./providers/bower-provider'));
var CompletionProvider = exports.CompletionProvider = {
    selector: '.source.json',
    inclusionPriority: 2,
    excludeLowerPriority: false,
    getSuggestions: getSuggestions,
    registerProvider: function registerProvider(provider) {
        providers.push(provider);
    },
    onDidInsertSuggestion: function onDidInsertSuggestion(_ref) {
        var editor = _ref.editor;
        var suggestion = _ref.suggestion;

        jsonCompletion.doResolve(suggestion).then(function () {
            if (_lodash2.default.endsWith(suggestion.text, '.')) {
                _lodash2.default.defer(function () {
                    return atom.commands.dispatch(atom.views.getView(editor), "autocomplete-plus:activate");
                });
            }
        });
    },
    dispose: function dispose() {}
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjaGVtYS1hdXRvY29tcGxldGUuanMiLCJzY2hlbWEtYXV0b2NvbXBsZXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7OztBQUVBOztBQUNBOztBQUNBOzs7O0FDQUEsSUFBSSxTQUFTLFFBQVEsWUFBUixFQUFzQixNQUFuQzs7QUFNQSxJQUFNLG9CQUFvQiwwQ0FBMUI7QUFDQSxJQUFNLGlCQUFpQixtQ0FBbUIsaUJBQW5CLEVBQXNDLEVBQXRDLENBQXZCO0FBVUEsU0FBQSxVQUFBLENBQW9CLE9BQXBCLEVBQXFDLE9BQXJDLEVBQXdHLElBQXhHLEVBQW9IO0FBQ2hILFFBQUksSUFBSSxpQkFBRSxJQUFGLENBQU8sT0FBUCxDQUFSO0FBQ0EsUUFBSSxpQkFBRSxVQUFGLENBQWEsQ0FBYixFQUFnQixHQUFoQixLQUF3QixpQkFBRSxVQUFGLENBQWEsQ0FBYixFQUFnQixHQUFoQixDQUF4QixJQUFnRCxpQkFBRSxRQUFGLENBQVcsQ0FBWCxFQUFjLEdBQWQsQ0FBaEQsSUFBc0UsaUJBQUUsUUFBRixDQUFXLENBQVgsRUFBYyxHQUFkLENBQXRFLElBQTRGLGlCQUFFLFFBQUYsQ0FBVyxDQUFYLEVBQWMsR0FBZCxDQUFoRyxFQUNJLE9BQU8sT0FBUDtBQUVKLFFBQUksQ0FBQyxRQUFRLGVBQWIsRUFDSSxVQUFVLE1BQU0sT0FBaEI7QUFDSixRQUFJLENBQUMsUUFBUSxnQkFBVCxJQUE2QixDQUFDLGlCQUFFLFFBQUYsQ0FBVyxPQUFYLEVBQW9CLEdBQXBCLENBQWxDLEVBQ0ksVUFBVSxVQUFVLEdBQXBCO0FBRUosUUFBSSxTQUFTLFFBQWIsRUFBdUI7QUFDbkIsa0JBQVUsV0FBVyxNQUFyQjtBQUNILEtBRkQsTUFFTyxJQUFJLFNBQVMsUUFBYixFQUF1QjtBQUMxQixrQkFBVSxXQUFXLE1BQXJCO0FBQ0gsS0FGTSxNQUVBLElBQUksU0FBUyxPQUFiLEVBQXNCO0FBQ3pCLGtCQUFVLFdBQVcsTUFBckI7QUFDSDtBQUVELFdBQU8sT0FBUDtBQUNIO0FBRUQsU0FBQSxjQUFBLENBQXdCLElBQXhCLEVBQWtGLE9BQWxGLEVBQTZLO0FBQ3pLLFFBQUksY0FBYyxLQUFLLFdBQXZCO1FBQ0ksWUFBWSxLQUFLLElBQUwsQ0FBVSxNQUFWLENBQWlCLENBQWpCLEVBQW9CLENBQXBCLENBRGhCO1FBRUksT0FBTyxVQUZYO0FBSUEsV0FBTztBQUNILGlCQUFTLEtBQUssR0FEWDtBQUVILGNBQU0sS0FBSyxHQUZSO0FBR0gsaUJBQVMsV0FBVyxLQUFLLEdBQWhCLEVBQXFCLE9BQXJCLEVBQThCLEtBQUssSUFBbkMsQ0FITjtBQUlILGNBQU0sSUFKSDtBQUtILHFCQUFhLEtBQUssR0FMZjtBQU1ILG1CQUFXLDBCQU5SO0FBT0gscUJBQWE7QUFQVixLQUFQO0FBVUg7QUFFRCxTQUFBLGdCQUFBLENBQTBCLFVBQTFCLEVBQTRDO0FBQ3hDLFFBQUksZUFBZSxJQUFuQixFQUF5QjtBQUNyQjtBQUNIO0FBQ0QseUJBQW1CLFVBQW5CO0FBQ0g7QUFFRCxTQUFBLGNBQUEsQ0FBd0IsT0FBeEIsRUFBK0M7QUFDM0MsV0FBTyxlQUFlLFNBQWYsQ0FBeUIsUUFBUSxNQUFqQyxFQUF5QyxRQUFRLGNBQWpELEVBQWlFLHVCQUFVLFFBQVEsTUFBUixDQUFlLE9BQWYsRUFBVixDQUFqRSxFQUNGLElBREUsQ0FDRztBQUFBLGVBQUssRUFBRSxLQUFQO0FBQUEsS0FESCxDQUFQO0FBRUg7QUFFRCxJQUFJLFlBQXFDLEdBQUcsTUFBSCxDQUFVLFFBQVEsMEJBQVIsQ0FBVixFQUErQyxNQUEvQyxDQUFzRCxRQUFRLDRCQUFSLENBQXRELENBQXpDO0FBRU8sSUFBSSxrREFBcUI7QUFDNUIsY0FBVSxjQURrQjtBQUU1Qix1QkFBbUIsQ0FGUztBQUc1QiwwQkFBc0IsS0FITTtBQUk1QixrQ0FKNEI7QUFLNUIsc0JBQWtCLDBCQUFDLFFBQUQsRUFBYztBQUM1QixrQkFBVSxJQUFWLENBQWUsUUFBZjtBQUNILEtBUDJCO0FBUTVCLHlCQVI0Qix1Q0FRK0Y7QUFBQSxZQUFwRyxNQUFvRyxRQUFwRyxNQUFvRztBQUFBLFlBQTVGLFVBQTRGLFFBQTVGLFVBQTRGOztBQUN2SCx1QkFBZSxTQUFmLENBQThCLFVBQTlCLEVBQ0ssSUFETCxDQUNVLFlBQUE7QUFDRixnQkFBSSxpQkFBRSxRQUFGLENBQVcsV0FBVyxJQUF0QixFQUE0QixHQUE1QixDQUFKLEVBQXNDO0FBQ2xDLGlDQUFFLEtBQUYsQ0FBUTtBQUFBLDJCQUFNLEtBQUssUUFBTCxDQUFjLFFBQWQsQ0FBdUIsS0FBSyxLQUFMLENBQVcsT0FBWCxDQUFtQixNQUFuQixDQUF2QixFQUFtRCw0QkFBbkQsQ0FBTjtBQUFBLGlCQUFSO0FBQ0g7QUFDSixTQUxMO0FBTUgsS0FmMkI7QUFnQjVCLFdBaEI0QixxQkFnQnJCLENBQU07QUFoQmUsQ0FBekIiLCJmaWxlIjoic2NoZW1hLWF1dG9jb21wbGV0ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG52YXIgZmlsdGVyID0gcmVxdWlyZSgnZnV6emFsZHJpbicpLmZpbHRlcjtcbmltcG9ydCB7IEpTT05TY2hlbWFTZXJ2aWNlIH0gZnJvbSAnLi92c2NvZGUvcGx1Z2luL2pzb25TY2hlbWFTZXJ2aWNlJztcbmltcG9ydCB7IHBhcnNlIGFzIHBhcnNlSlNPTiB9IGZyb20gJy4vdnNjb2RlL3BsdWdpbi9qc29uUGFyc2VyJztcbmltcG9ydCB7IEpTT05Db21wbGV0aW9uIH0gZnJvbSAnLi92c2NvZGUvcGx1Z2luL2pzb25Db21wbGV0aW9uJztcbmNvbnN0IGpzb25TY2hlbWFTZXJ2aWNlID0gbmV3IEpTT05TY2hlbWFTZXJ2aWNlKCk7XG5jb25zdCBqc29uQ29tcGxldGlvbiA9IG5ldyBKU09OQ29tcGxldGlvbihqc29uU2NoZW1hU2VydmljZSwgW10pO1xuZnVuY3Rpb24gZml4U25pcHBldChzbmlwcGV0LCBvcHRpb25zLCB0eXBlKSB7XG4gICAgbGV0IHQgPSBfLnRyaW0oc25pcHBldCk7XG4gICAgaWYgKF8uc3RhcnRzV2l0aCh0LCAneycpIHx8IF8uc3RhcnRzV2l0aCh0LCAnXCInKSB8fCBfLmVuZHNXaXRoKHQsICd9JykgfHwgXy5lbmRzV2l0aCh0LCAnXCInKSB8fCBfLmVuZHNXaXRoKHQsICcsJykpXG4gICAgICAgIHJldHVybiBzbmlwcGV0O1xuICAgIGlmICghb3B0aW9ucy5oYXNMZWFkaW5nUXVvdGUpXG4gICAgICAgIHNuaXBwZXQgPSAnXCInICsgc25pcHBldDtcbiAgICBpZiAoIW9wdGlvbnMuaGFzVHJhaWxpbmdRdW90ZSAmJiAhXy5lbmRzV2l0aChzbmlwcGV0LCAnLicpKVxuICAgICAgICBzbmlwcGV0ID0gc25pcHBldCArICdcIic7XG4gICAgaWYgKHR5cGUgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgc25pcHBldCA9IHNuaXBwZXQgKz0gJzogXCJcIic7XG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGUgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgc25pcHBldCA9IHNuaXBwZXQgKz0gJzoge30nO1xuICAgIH1cbiAgICBlbHNlIGlmICh0eXBlID09PSBcImFycmF5XCIpIHtcbiAgICAgICAgc25pcHBldCA9IHNuaXBwZXQgKz0gJzogW10nO1xuICAgIH1cbiAgICByZXR1cm4gc25pcHBldDtcbn1cbmZ1bmN0aW9uIG1ha2VTdWdnZXN0aW9uKGl0ZW0sIG9wdGlvbnMpIHtcbiAgICB2YXIgZGVzY3JpcHRpb24gPSBpdGVtLmRlc2NyaXB0aW9uLCBsZWZ0TGFiZWwgPSBpdGVtLnR5cGUuc3Vic3RyKDAsIDEpLCB0eXBlID0gJ3ZhcmlhYmxlJztcbiAgICByZXR1cm4ge1xuICAgICAgICBfc2VhcmNoOiBpdGVtLmtleSxcbiAgICAgICAgdGV4dDogaXRlbS5rZXksXG4gICAgICAgIHNuaXBwZXQ6IGZpeFNuaXBwZXQoaXRlbS5rZXksIG9wdGlvbnMsIGl0ZW0udHlwZSksXG4gICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgIGRpc3BsYXlUZXh0OiBpdGVtLmtleSxcbiAgICAgICAgY2xhc3NOYW1lOiAnYXV0b2NvbXBsZXRlLWpzb24tc2NoZW1hJyxcbiAgICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uLFxuICAgIH07XG59XG5mdW5jdGlvbiByZW5kZXJSZXR1cm5UeXBlKHJldHVyblR5cGUpIHtcbiAgICBpZiAocmV0dXJuVHlwZSA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHJldHVybiBgUmV0dXJuczogJHtyZXR1cm5UeXBlfWA7XG59XG5mdW5jdGlvbiBnZXRTdWdnZXN0aW9ucyhvcHRpb25zKSB7XG4gICAgcmV0dXJuIGpzb25Db21wbGV0aW9uLmRvU3VnZ2VzdChvcHRpb25zLmVkaXRvciwgb3B0aW9ucy5idWZmZXJQb3NpdGlvbiwgcGFyc2VKU09OKG9wdGlvbnMuZWRpdG9yLmdldFRleHQoKSkpXG4gICAgICAgIC50aGVuKHggPT4geC5pdGVtcyk7XG59XG52YXIgcHJvdmlkZXJzID0gW10uY29uY2F0KHJlcXVpcmUoJy4vcHJvdmlkZXJzL25wbS1wcm92aWRlcicpKS5jb25jYXQocmVxdWlyZSgnLi9wcm92aWRlcnMvYm93ZXItcHJvdmlkZXInKSk7XG5leHBvcnQgdmFyIENvbXBsZXRpb25Qcm92aWRlciA9IHtcbiAgICBzZWxlY3RvcjogJy5zb3VyY2UuanNvbicsXG4gICAgaW5jbHVzaW9uUHJpb3JpdHk6IDIsXG4gICAgZXhjbHVkZUxvd2VyUHJpb3JpdHk6IGZhbHNlLFxuICAgIGdldFN1Z2dlc3Rpb25zLFxuICAgIHJlZ2lzdGVyUHJvdmlkZXI6IChwcm92aWRlcikgPT4ge1xuICAgICAgICBwcm92aWRlcnMucHVzaChwcm92aWRlcik7XG4gICAgfSxcbiAgICBvbkRpZEluc2VydFN1Z2dlc3Rpb24oeyBlZGl0b3IsIHN1Z2dlc3Rpb24gfSkge1xuICAgICAgICBqc29uQ29tcGxldGlvbi5kb1Jlc29sdmUoc3VnZ2VzdGlvbilcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIGlmIChfLmVuZHNXaXRoKHN1Z2dlc3Rpb24udGV4dCwgJy4nKSkge1xuICAgICAgICAgICAgICAgIF8uZGVmZXIoKCkgPT4gYXRvbS5jb21tYW5kcy5kaXNwYXRjaChhdG9tLnZpZXdzLmdldFZpZXcoZWRpdG9yKSwgXCJhdXRvY29tcGxldGUtcGx1czphY3RpdmF0ZVwiKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgZGlzcG9zZSgpIHsgfVxufTtcbiIsImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XHJcbmltcG9ydCB7U3ViamVjdCwgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHtDb21wb3NpdGVEaXNwb3NhYmxlfSBmcm9tICcuL2Rpc3Bvc2FibGVzJztcclxuLy92YXIgZXNjYXBlID0gcmVxdWlyZShcImVzY2FwZS1odG1sXCIpO1xyXG52YXIgZmlsdGVyID0gcmVxdWlyZSgnZnV6emFsZHJpbicpLmZpbHRlcjtcclxuXHJcbmltcG9ydCB7SlNPTlNjaGVtYVNlcnZpY2UsIElTY2hlbWFBc3NvY2lhdGlvbnN9IGZyb20gJy4vdnNjb2RlL3BsdWdpbi9qc29uU2NoZW1hU2VydmljZSc7XHJcbmltcG9ydCB7cGFyc2UgYXMgcGFyc2VKU09OLCBPYmplY3RBU1ROb2RlLCBKU09ORG9jdW1lbnR9IGZyb20gJy4vdnNjb2RlL3BsdWdpbi9qc29uUGFyc2VyJztcclxuaW1wb3J0IHtKU09OQ29tcGxldGlvbn0gZnJvbSAnLi92c2NvZGUvcGx1Z2luL2pzb25Db21wbGV0aW9uJztcclxuXHJcbmNvbnN0IGpzb25TY2hlbWFTZXJ2aWNlID0gbmV3IEpTT05TY2hlbWFTZXJ2aWNlKCk7XHJcbmNvbnN0IGpzb25Db21wbGV0aW9uID0gbmV3IEpTT05Db21wbGV0aW9uKGpzb25TY2hlbWFTZXJ2aWNlLCBbXSk7XHJcblxyXG5pbnRlcmZhY2UgUmVxdWVzdE9wdGlvbnMge1xyXG4gICAgZWRpdG9yOiBBdG9tLlRleHRFZGl0b3I7XHJcbiAgICBidWZmZXJQb3NpdGlvbjogVGV4dEJ1ZmZlci5Qb2ludDsgLy8gdGhlIHBvc2l0aW9uIG9mIHRoZSBjdXJzb3JcclxuICAgIHByZWZpeDogc3RyaW5nO1xyXG4gICAgc2NvcGVEZXNjcmlwdG9yOiB7IHNjb3Blczogc3RyaW5nW10gfTtcclxuICAgIGFjdGl2YXRlZE1hbnVhbGx5OiBib29sZWFuO1xyXG59XHJcblxyXG5mdW5jdGlvbiBmaXhTbmlwcGV0KHNuaXBwZXQ6IHN0cmluZywgb3B0aW9uczogeyBoYXNUcmFpbGluZ1F1b3RlOiBib29sZWFuOyBoYXNMZWFkaW5nUXVvdGU6IGJvb2xlYW47IH0sIHR5cGU6IHN0cmluZykge1xyXG4gICAgbGV0IHQgPSBfLnRyaW0oc25pcHBldCk7XHJcbiAgICBpZiAoXy5zdGFydHNXaXRoKHQsICd7JykgfHwgXy5zdGFydHNXaXRoKHQsICdcIicpIHx8IF8uZW5kc1dpdGgodCwgJ30nKSB8fCBfLmVuZHNXaXRoKHQsICdcIicpIHx8IF8uZW5kc1dpdGgodCwgJywnKSlcclxuICAgICAgICByZXR1cm4gc25pcHBldDtcclxuXHJcbiAgICBpZiAoIW9wdGlvbnMuaGFzTGVhZGluZ1F1b3RlKVxyXG4gICAgICAgIHNuaXBwZXQgPSAnXCInICsgc25pcHBldDtcclxuICAgIGlmICghb3B0aW9ucy5oYXNUcmFpbGluZ1F1b3RlICYmICFfLmVuZHNXaXRoKHNuaXBwZXQsICcuJykpXHJcbiAgICAgICAgc25pcHBldCA9IHNuaXBwZXQgKyAnXCInO1xyXG5cclxuICAgIGlmICh0eXBlID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgc25pcHBldCA9IHNuaXBwZXQgKz0gJzogXCJcIidcclxuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJvYmplY3RcIikge1xyXG4gICAgICAgIHNuaXBwZXQgPSBzbmlwcGV0ICs9ICc6IHt9J1xyXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBcImFycmF5XCIpIHtcclxuICAgICAgICBzbmlwcGV0ID0gc25pcHBldCArPSAnOiBbXSdcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gc25pcHBldDtcclxufVxyXG5cclxuZnVuY3Rpb24gbWFrZVN1Z2dlc3Rpb24oaXRlbTogeyBrZXk6IHN0cmluZzsgZGVzY3JpcHRpb246IHN0cmluZzsgdHlwZTogc3RyaW5nIH0sIG9wdGlvbnM6IHsgcmVwbGFjZW1lbnRQcmVmaXg6IHN0cmluZzsgaGFzVHJhaWxpbmdRdW90ZTogYm9vbGVhbjsgaGFzTGVhZGluZ1F1b3RlOiBib29sZWFuIH0pIHtcclxuICAgIHZhciBkZXNjcmlwdGlvbiA9IGl0ZW0uZGVzY3JpcHRpb24sXHJcbiAgICAgICAgbGVmdExhYmVsID0gaXRlbS50eXBlLnN1YnN0cigwLCAxKSxcclxuICAgICAgICB0eXBlID0gJ3ZhcmlhYmxlJztcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIF9zZWFyY2g6IGl0ZW0ua2V5LFxyXG4gICAgICAgIHRleHQ6IGl0ZW0ua2V5LFxyXG4gICAgICAgIHNuaXBwZXQ6IGZpeFNuaXBwZXQoaXRlbS5rZXksIG9wdGlvbnMsIGl0ZW0udHlwZSksXHJcbiAgICAgICAgdHlwZTogdHlwZSxcclxuICAgICAgICBkaXNwbGF5VGV4dDogaXRlbS5rZXksXHJcbiAgICAgICAgY2xhc3NOYW1lOiAnYXV0b2NvbXBsZXRlLWpzb24tc2NoZW1hJyxcclxuICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24sXHJcbiAgICAgICAgLy9sZWZ0TGFiZWw6IGxlZnRMYWJlbCxcclxuICAgIH07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlbmRlclJldHVyblR5cGUocmV0dXJuVHlwZTogc3RyaW5nKSB7XHJcbiAgICBpZiAocmV0dXJuVHlwZSA9PT0gbnVsbCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHJldHVybiBgUmV0dXJuczogJHtyZXR1cm5UeXBlfWA7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFN1Z2dlc3Rpb25zKG9wdGlvbnM6IFJlcXVlc3RPcHRpb25zKTogUHJvbWlzZTxTdWdnZXN0aW9uW10+IHtcclxuICAgIHJldHVybiBqc29uQ29tcGxldGlvbi5kb1N1Z2dlc3Qob3B0aW9ucy5lZGl0b3IsIG9wdGlvbnMuYnVmZmVyUG9zaXRpb24sIHBhcnNlSlNPTihvcHRpb25zLmVkaXRvci5nZXRUZXh0KCkpKVxyXG4gICAgICAgIC50aGVuKHggPT4geC5pdGVtcyk7XHJcbn1cclxuXHJcbnZhciBwcm92aWRlcnM6IElBdXRvY29tcGxldGVQcm92aWRlcltdID0gW10uY29uY2F0KHJlcXVpcmUoJy4vcHJvdmlkZXJzL25wbS1wcm92aWRlcicpKS5jb25jYXQocmVxdWlyZSgnLi9wcm92aWRlcnMvYm93ZXItcHJvdmlkZXInKSk7XHJcblxyXG5leHBvcnQgdmFyIENvbXBsZXRpb25Qcm92aWRlciA9IHtcclxuICAgIHNlbGVjdG9yOiAnLnNvdXJjZS5qc29uJyxcclxuICAgIGluY2x1c2lvblByaW9yaXR5OiAyLFxyXG4gICAgZXhjbHVkZUxvd2VyUHJpb3JpdHk6IGZhbHNlLFxyXG4gICAgZ2V0U3VnZ2VzdGlvbnMsXHJcbiAgICByZWdpc3RlclByb3ZpZGVyOiAocHJvdmlkZXI6IGFueSkgPT4ge1xyXG4gICAgICAgIHByb3ZpZGVycy5wdXNoKHByb3ZpZGVyKTtcclxuICAgIH0sXHJcbiAgICBvbkRpZEluc2VydFN1Z2dlc3Rpb24oe2VkaXRvciwgc3VnZ2VzdGlvbn06IHsgZWRpdG9yOiBBdG9tLlRleHRFZGl0b3I7IHRyaWdnZXJQb3NpdGlvbjogYW55OyBzdWdnZXN0aW9uOiB7IHRleHQ6IHN0cmluZyB9IH0pIHtcclxuICAgICAgICBqc29uQ29tcGxldGlvbi5kb1Jlc29sdmUoPGFueT5zdWdnZXN0aW9uKVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoXy5lbmRzV2l0aChzdWdnZXN0aW9uLnRleHQsICcuJykpIHtcclxuICAgICAgICAgICAgICAgICAgICBfLmRlZmVyKCgpID0+IGF0b20uY29tbWFuZHMuZGlzcGF0Y2goYXRvbS52aWV3cy5nZXRWaWV3KGVkaXRvciksIFwiYXV0b2NvbXBsZXRlLXBsdXM6YWN0aXZhdGVcIikpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGRpc3Bvc2UoKSB7IH1cclxufVxyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
